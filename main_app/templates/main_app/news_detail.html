{% extends 'main_app/base.html' %}
{% load static %}
{% block title %}{{ article.title }} - COSA Alumni News{% endblock %}
{% block content %}
<section class="article-hero app-full-bleed">
  <a href="{% url 'public_news' %}" class="article-hero__back">
    <i class="fas fa-arrow-left"></i>
    Back to news
  </a>

  <span class="article-hero__category article-hero__category--{{ article.category|default:'general' }}">
    {{ article.get_category_display }}
  </span>

  <h1 class="article-hero__title">{{ article.title }}</h1>

  <div class="article-hero__meta">
    <span class="article-hero__meta-item d-inline-flex align-items-center gap-2">
      {% if article.author.admin.profile_pic %}
      <img
        src="{{ article.author.admin.profile_pic.url }}"
        alt="{{ article.author.admin.get_full_name }}"
        class="avatar"
        width="48"
        height="48"
      />
      {% else %}
      <span class="avatar d-inline-flex align-items-center justify-content-center bg-primary text-white">
        <i class="fas fa-user"></i>
      </span>
      {% endif %}
      <span>
        <strong>{{ article.author.admin.get_full_name }}</strong><br />
        <small>Alumni Coordinator</small>
      </span>
    </span>
    <span class="article-hero__meta-item">
      <i class="fas fa-calendar"></i>
      {{ article.publish_date|date:"F d, Y" }}
    </span>
    {% if article.read_time %}
    <span class="article-hero__meta-item">
      <i class="fas fa-clock"></i>
      {{ article.read_time }} min read
    </span>
    {% endif %}
  </div>
</section>

<section class="article-body">
  <div class="article-body__layout">
    <article class="article-body__main">
      {% if article.featured_image %}
      <img
        src="{{ article.featured_image.url }}"
        alt="{{ article.title }}"
        class="w-100"
      />
      {% endif %}

      {% if article.meta_description %}
      <div class="article-body__lead">
        {{ article.meta_description }}
      </div>
      {% endif %}

      <div class="article-body__content">
        {{ article.content|safe }}
      </div>

      {% if article.tags.exists %}
      <div>
        <h6 class="text-muted mb-2">Tags</h6>
        <div class="article-body__tags">
          {% for tag in article.tags.all %}
          <span class="chip">{{ tag.name }}</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <div class="article-body__actions">
        <span class="text-muted fw-semibold">Share this article</span>
        <a
          href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
          target="_blank"
          class="btn btn-outline-primary btn-sm"
        >
          <i class="fab fa-facebook-f me-2"></i>
          Facebook
        </a>
        <a
          href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ article.title }}"
          target="_blank"
          class="btn btn-outline-info btn-sm"
        >
          <i class="fab fa-twitter me-2"></i>
          Twitter
        </a>
        <a
          href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}"
          target="_blank"
          class="btn btn-outline-primary btn-sm"
        >
          <i class="fab fa-linkedin-in me-2"></i>
          LinkedIn
        </a>
        <button
          type="button"
          class="btn btn-outline-secondary btn-sm js-copy-article-link"
          data-link="{{ request.build_absolute_uri }}"
        >
          <i class="fas fa-link me-2"></i>
          Copy link
        </button>
      </div>
    </article>

    <aside class="article-body__aside">
      <div class="article-sidebar-card">
        <h6 class="article-sidebar-card__title">
          <i class="fas fa-share-alt me-2 text-primary"></i>
          Share article
        </h6>
        <div class="d-grid gap-2">
          <a
            href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
            target="_blank"
            class="btn btn-outline-primary btn-sm"
          >
            <i class="fab fa-facebook-f me-2"></i>
            Facebook
          </a>
          <a
            href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ article.title }}"
            target="_blank"
            class="btn btn-outline-info btn-sm"
          >
            <i class="fab fa-twitter me-2"></i>
            Twitter
          </a>
          <a
            href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}"
            target="_blank"
            class="btn btn-outline-primary btn-sm"
          >
            <i class="fab fa-linkedin-in me-2"></i>
            LinkedIn
          </a>
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm js-copy-article-link"
            data-link="{{ request.build_absolute_uri }}"
          >
            <i class="fas fa-link me-2"></i>
            Copy link
          </button>
        </div>
      </div>

      <div class="article-sidebar-card">
        <h6 class="article-sidebar-card__title">
          <i class="fas fa-user me-2 text-primary"></i>
          About the author
        </h6>
        <div class="d-flex align-items-center gap-3">
          {% if article.author.admin.profile_pic %}
          <img
            src="{{ article.author.admin.profile_pic.url }}"
            alt="{{ article.author.admin.get_full_name }}"
            class="avatar"
            width="64"
            height="64"
          />
          {% else %}
          <span class="feed-story__avatar">
            <i class="fas fa-user"></i>
          </span>
          {% endif %}
          <div>
            <h6 class="mb-1">{{ article.author.admin.get_full_name }}</h6>
            <p class="text-muted small mb-0">Alumni Coordinator</p>
            {% if article.author.department %}
            <p class="text-muted small mb-0">{{ article.author.department }}</p>
            {% endif %}
          </div>
        </div>
      </div>

      {% if related_news %}
      <div class="article-sidebar-card">
        <h6 class="article-sidebar-card__title">
          <i class="fas fa-newspaper me-2 text-primary"></i>
          Related stories
        </h6>
        <div class="article-related">
          {% for related in related_news %}
          <a href="{% url 'news_detail' related.slug %}" class="article-related__item text-decoration-none">
            <span class="text-uppercase small fw-semibold text-primary">{{ related.get_category_display }}</span>
            <span class="fw-semibold text-dark">{{ related.title|truncatewords:12 }}</span>
            <span class="text-muted small">
              <i class="fas fa-calendar me-1"></i>
              {{ related.publish_date|date:"M d, Y" }}
            </span>
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <div class="article-sidebar-card">
        <h6 class="article-sidebar-card__title">
          <i class="fas fa-envelope me-2 text-primary"></i>
          Stay in touch
        </h6>
        <p class="text-muted small">
          Get the latest updates about COSA alumni in your inbox.
        </p>
        <form class="stack-gap-sm">
          <input type="email" class="form-control" placeholder="Your email" required />
          <button type="submit" class="btn btn-primary btn-sm">Subscribe</button>
        </form>
      </div>

      <div class="article-sidebar-card">
        <h6 class="article-sidebar-card__title">
          <i class="fas fa-link me-2 text-primary"></i>
          Quick links
        </h6>
        <div class="d-grid gap-2">
          <a href="{% url 'public_news' %}" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-newspaper me-2"></i>
            All news
          </a>
          <a href="{% url 'public_events' %}" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-calendar-alt me-2"></i>
            Events
          </a>
          <a href="{% url 'public_job_board' %}" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-briefcase me-2"></i>
            Jobs
          </a>
          <a href="{% url 'public_alumni_directory' %}" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-users me-2"></i>
            Alumni directory
          </a>
        </div>
      </div>
    </aside>
  </div>
</section>

<section class="app-section">
  <div class="app-section-inner">
    {% include 'main_app/like_comment_section.html' %}
  </div>
</section>

<section class="app-section">
  <div class="app-section-inner">
    <div class="article-navigation">
      <a href="{% url 'public_news' %}" class="btn btn-outline-primary">
        <i class="fas fa-arrow-left me-2"></i>
        Back to news
      </a>
      <span class="article-navigation__date">
        Published on {{ article.publish_date|date:"F d, Y" }}
      </span>
      <a href="{% url 'public_news' %}" class="btn btn-primary">
        More stories
        <i class="fas fa-arrow-right ms-2"></i>
      </a>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.js-copy-article-link').forEach(function (button) {
      button.addEventListener('click', function () {
        const original = button.innerHTML;
        const targetLink = button.dataset.link || window.location.href;

        navigator.clipboard
          .writeText(targetLink)
          .then(function () {
            button.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
            button.classList.remove('btn-outline-secondary');
            button.classList.add('btn-success');

            setTimeout(function () {
              button.innerHTML = original;
              button.classList.remove('btn-success');
              button.classList.add('btn-outline-secondary');
            }, 2000);
          })
          .catch(function () {
            button.innerHTML = '<i class="fas fa-times me-2"></i>Try again';
            button.classList.remove('btn-outline-secondary');
            button.classList.add('btn-danger');

            setTimeout(function () {
              button.innerHTML = original;
              button.classList.remove('btn-danger');
              button.classList.add('btn-outline-secondary');
            }, 2000);
          });
      });
    });
  });
</script>
{% endblock %}
